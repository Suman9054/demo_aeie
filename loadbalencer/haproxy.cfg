global
  log /dev/log local0 debug

defaults
  log     global
  mode    http
  option  httplog
  option  dontlognull
  timeout connect 10s
  timeout client  30s
  timeout server  30s
  option forwardfor

frontend main
  bind :10000
  # Add proper headers for backend services
  http-request set-header Host %[req.hdr(host)]
  http-request set-header X-Forwarded-Proto https
  acl is_api path_beg /api
  use_backend api_servers if is_api
  default_backend api_servers

backend api_servers
  balance roundrobin
  # Add proper host header for Render services
  http-request set-header Host aeie-club-server-1.onrender.com if { srv_id 0 }
  http-request set-header Host aeie-club-server.onrender.com if { srv_id 1 }
  # Add health checks
  option httpchk GET /
  http-check expect status 200
  # CHANGED: Removed SSL and port 443, now using HTTP port 80
  server api1 aeie-club-server-1.onrender.com:80 check
  server api2 aeie-club-server.onrender.com:80 check
