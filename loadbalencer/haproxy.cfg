global


defaults
  log     global
  mode    http
  option  httplog
  option  dontlognull
  timeout connect 10s
  timeout client  30s
  timeout server  30s
  option forwardfor

frontend main
  bind :10000
  # Add proper headers for backend services
  http-request set-header Host %[req.hdr(host)]
  http-request set-header X-Forwarded-Proto https
  acl is_api path_beg /api
  use_backend api_servers if is_api
  default_backend api_servers

backend api_servers
  balance roundrobin
  http-check send meth GET uri /api/health ver HTTP/1.1 hdr Host %[srv_name].onrender.com hdr User-Agent HAProxy
  http-check expect status 200
  
  
  # CHANGED: Removed SSL and port 443, now using HTTP port 80
  server api1 aeie-club-server-1.onrender.com:80 check
  server api2 aeie-club-server.onrender.com:80 check
