global
  log stdout local0 debug
  maxconn 2048

defaults
  log global
  mode http
  timeout connect 10s
  timeout client  30s
  timeout server  30s
  option httplog
  option dontlognull
  
frontend main
  bind :10000
  
  # Add forwarding headers for backend identification
  http-request set-header X-Forwarded-Proto http
  http-request set-header X-Forwarded-Port 10000
  
  acl is_api path_beg /api/v1/

  use_backend api_servers if is_api
  default_backend api_servers

backend api_servers
  balance roundrobin
  
  # Health check for Render.com services
  option httpchk GET /health HTTP/1.1\r\nHost:\ aeie-club-server-1.onrender.com
  
  # Render.com servers with HTTPS and proper host headers
  server api1 aeie-club-server-1.onrender.com:443  check maxconn 500
  server api2 aeie-club-server.onrender.com:443 check  maxconn 500
  
  # Set proper Host header for Render.com routing
  http-request set-header Host aeie-club-server-1.onrender.com if { srv_id 0 }
  http-request set-header Host aeie-club-server.onrender.com if { srv_id 1 }